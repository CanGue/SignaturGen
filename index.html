<!DOCTYPE html>
<html lang="de" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="meta.title">SignaturGen - Kostenlose Digitale Unterschrift</title>
    <meta name="description" content="Erstelle deine professionelle digitale Unterschrift in Sekunden. Kostenlos, sicher und ohne Anmeldung.">
    
    <!-- PERFORMANCE: Preconnect für schnelleres Laden von Tailwind -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: #f8fafc;
            touch-action: pan-y; 
        }
        
        canvas {
            cursor: crosshair;
            background-color: #ffffff;
            /* PERFORMANCE: CSS-Pattern statt komplexem Bild */
            background-image: radial-gradient(#e2e8f0 1px, transparent 1px);
            background-size: 20px 20px;
            touch-action: none; 
            /* PERFORMANCE: Will-change hint für den Compositor */
            will-change: content; 
        }

        .tool-btn { transition: transform 0.1s ease-out, background-color 0.2s; }
        .tool-btn:active { transform: scale(0.96); }

        .btn-magic { background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); }
        .btn-magic:hover {
            background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%);
            box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.3);
        }

        .modal-overlay {
            background-color: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(4px); /* PERFORMANCE: Blur reduziert auf 4px für mobile Performance */
        }
        
        .checkerboard {
            background-image: linear-gradient(45deg, #e5e7eb 25%, transparent 25%), 
                              linear-gradient(-45deg, #e5e7eb 25%, transparent 25%), 
                              linear-gradient(45deg, transparent 75%, #e5e7eb 75%), 
                              linear-gradient(-45deg, transparent 75%, #e5e7eb 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        
        .hide-scroll::-webkit-scrollbar { height: 4px; }
        .hide-scroll::-webkit-scrollbar-track { background: transparent; }
        .hide-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        
        .preview-card.selected {
            border-color: #4f46e5;
            background-color: #eef2ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.2);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        /* PERFORMANCE: Utility class für Icons */
        .icon { width: 1.25rem; height: 1.25rem; stroke: currentColor; stroke-width: 2; fill: none; stroke-linecap: round; stroke-linejoin: round; }
        .icon-sm { width: 0.75rem; height: 0.75rem; }
        .icon-lg { width: 1.5rem; height: 1.5rem; }
    </style>
</head>
<body class="text-slate-600 antialiased">

    <!-- HEADER -->
    <header class="fixed w-full bg-white/90 backdrop-blur-sm border-b border-slate-200 z-40">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-2 cursor-pointer" onclick="window.scrollTo(0,0)">
                    <div class="bg-indigo-600 p-1.5 rounded-lg text-white">
                        <!-- ICON: pen-line -->
                        <svg class="icon" viewBox="0 0 24 24"><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/></svg>
                    </div>
                    <span class="font-bold text-xl text-slate-800 tracking-tight">Signatur<span class="text-indigo-600">Gen</span></span>
                </div>
                
                <nav class="hidden md:flex gap-8 text-sm font-medium">
                    <button onclick="openInfoModal('features-modal')" class="hover:text-indigo-600 transition-colors" data-i18n="nav.features">Features</button>
                    <button onclick="openInfoModal('howto-modal')" class="hover:text-indigo-600 transition-colors" data-i18n="nav.howto">So funktioniert's</button>
                    <button onclick="openInfoModal('faq-header-modal')" class="hover:text-indigo-600 transition-colors" data-i18n="nav.faq">FAQ</button>
                </nav>
                <div class="w-8"></div> 
            </div>
        </div>
    </header>

    <!-- HERO SECTION -->
    <section id="tool-section" class="pt-28 pb-16 lg:pt-32 lg:pb-24 bg-gradient-to-b from-indigo-50 via-white to-white overflow-hidden relative">
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-full overflow-hidden pointer-events-none z-0">
            <!-- PERFORMANCE: Animationen bleiben, aber blobs werden nicht interaktiv sein -->
            <div class="absolute top-20 left-10 w-72 h-72 bg-purple-200 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-blob"></div>
            <div class="absolute top-20 right-10 w-72 h-72 bg-indigo-200 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-blob animation-delay-2000"></div>
        </div>

        <div class="max-w-4xl mx-auto px-4 sm:px-6 relative z-10 text-center mb-8">
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-indigo-100 text-indigo-700 text-xs font-semibold mb-4 border border-indigo-200">
                <span class="flex h-2 w-2 rounded-full bg-indigo-600"></span>
                <span data-i18n="hero.badge">Neu: KI-gestützte Glättung</span>
            </div>
            <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold text-slate-900 tracking-tight mb-4">
                <span data-i18n="hero.title_line1">Deine Unterschrift.</span><br/> 
                <span class="text-indigo-600" data-i18n="hero.title_line2">Digital & Perfekt.</span>
            </h1>
            <p class="text-lg text-slate-600 max-w-2xl mx-auto mb-8" data-i18n="hero.subtitle">
                Erstelle blitzschnell eine transparente PNG-Unterschrift für deine PDF-Dokumente, E-Mails und Verträge. 100% lokal im Browser.
            </p>
        </div>

        <!-- TOOL CARD -->
        <div class="max-w-3xl mx-auto px-4 sm:px-6 relative z-10 animate-fade-in">
            <div class="bg-white p-2 sm:p-6 rounded-2xl shadow-2xl shadow-indigo-100 border border-slate-200">
                
                <div class="flex items-center justify-between mb-4 px-2">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-red-400"></div>
                        <div class="w-3 h-3 rounded-full bg-yellow-400"></div>
                        <div class="w-3 h-3 rounded-full bg-green-400"></div>
                    </div>
                    <span class="text-xs font-mono text-slate-400">signature_pad.exe</span>
                </div>

                <div class="relative w-full h-64 sm:h-80 border-2 border-dashed border-slate-300 rounded-xl overflow-hidden mb-6 bg-slate-50 group transition-colors hover:border-indigo-300" id="canvas-container">
                    <canvas id="signature-pad" class="w-full h-full block"></canvas>
                    <div id="placeholder-text" class="absolute inset-0 flex items-center justify-center pointer-events-none text-slate-400 select-none text-xl font-medium group-hover:text-indigo-400 transition-colors" data-i18n="tool.placeholder">
                        Hier unterschreiben
                    </div>
                </div>

                <!-- VARIATIONS -->
                <div id="variations-wrapper" class="hidden mb-6 bg-slate-50 p-4 rounded-xl border border-slate-100">
                    <div class="flex items-center justify-between mb-3">
                        <label class="text-xs font-bold text-indigo-900 uppercase tracking-wide flex items-center gap-2">
                            <!-- ICON: sparkles -->
                            <svg class="icon-sm text-indigo-500" viewBox="0 0 24 24"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
                            <span data-i18n="tool.select_style">Stil auswählen</span>
                        </label>
                        <button class="text-xs text-slate-500 hover:text-red-500 flex items-center gap-1 transition-colors" onclick="closeVariations()">
                            <!-- ICON: x -->
                            <svg class="icon-sm" viewBox="0 0 24 24"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                            <span data-i18n="tool.close">Schließen</span>
                        </button>
                    </div>
                    <div id="variations-container" class="flex gap-4 overflow-x-auto hide-scroll pb-2 px-1"></div>
                </div>

                <!-- TOOLBAR -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-2 bg-white pt-2">
                    <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4">
                        <div class="flex gap-2 p-1.5 bg-slate-100 rounded-full">
                            <button class="color-btn w-8 h-8 rounded-full border-2 border-indigo-500 bg-black shadow-sm transform transition-transform hover:scale-110" data-color="#000000" onclick="setColor('#000000', this)"></button>
                            <button class="color-btn w-8 h-8 rounded-full border border-slate-300 bg-blue-700 shadow-sm transform transition-transform hover:scale-110" data-color="#1d4ed8" onclick="setColor('#1d4ed8', this)"></button>
                            <button class="color-btn w-8 h-8 rounded-full border border-slate-300 bg-red-600 shadow-sm transform transition-transform hover:scale-110" data-color="#dc2626" onclick="setColor('#dc2626', this)"></button>
                            <div class="relative w-8 h-8 overflow-hidden rounded-full border border-slate-300 cursor-pointer hover:scale-110 transition-transform">
                                <input type="color" id="custom-color" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[150%] h-[150%] p-0 border-0 cursor-pointer" onchange="setColor(this.value, null)">
                            </div>
                        </div>
                        <div class="flex items-center gap-2 w-full sm:w-auto">
                            <!-- ICON: circle-dot -->
                            <svg class="icon text-slate-400" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="1"/></svg>
                            <input type="range" min="1" max="8" value="2" class="w-full sm:w-24 h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600" id="pen-width" oninput="setLineWidth(this.value)">
                        </div>
                    </div>

                    <div class="flex items-center justify-end gap-2 w-full">
                        <button onclick="clearCanvas()" class="tool-btn p-2.5 text-slate-500 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors" title="Löschen">
                            <!-- ICON: trash-2 -->
                            <svg class="icon icon-lg" viewBox="0 0 24 24"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                        </button>
                        
                        <button onclick="generatePreviews()" class="tool-btn px-4 py-2.5 text-white btn-magic rounded-lg font-medium flex items-center gap-2 shadow-lg shadow-indigo-200">
                            <!-- ICON: wand-2 -->
                            <svg class="icon" viewBox="0 0 24 24"><path d="m19 2 2 2-2 2-2-2Z"/><path d="m5 6 3 3-3 3-3-3Z"/><path d="m15 11 3 3-3 3-3-3Z"/><path d="M11 2 2 11l9 9 9-9Z"/><path d="m22 22-9-9"/></svg>
                            <span class="hidden sm:inline" data-i18n="tool.optimize">Optimieren</span>
                        </button>

                        <button onclick="downloadSignature()" class="tool-btn px-5 py-2.5 bg-slate-900 hover:bg-slate-800 text-white rounded-lg font-semibold shadow-lg flex items-center gap-2">
                            <!-- ICON: download -->
                            <svg class="icon" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                            <span data-i18n="tool.save">Speichern</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <p class="mt-4 text-center text-slate-400 text-xs flex items-center justify-center gap-1">
                <!-- ICON: shield-check -->
                <svg class="icon-sm" viewBox="0 0 24 24"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/><path d="m9 12 2 2 4-4"/></svg>
                <span data-i18n="tool.privacy_hint">Datenschutz: Deine Unterschrift verlässt niemals deinen Browser.</span>
            </p>
        </div>
    </section>

    <!-- FEATURES -->
    <section id="features" class="py-20 bg-white border-t border-slate-100">
        <div class="max-w-6xl mx-auto px-4 sm:px-6">
            <div class="text-center mb-16">
                <h2 class="text-3xl font-bold text-slate-900 mb-4" data-i18n="features.title">Warum SignaturGen?</h2>
                <p class="text-slate-500 max-w-2xl mx-auto" data-i18n="features.subtitle">Wir nutzen fortschrittliche Algorithmen, um aus deiner Maus-Zeichnung eine elegante, vektor-ähnliche Unterschrift zu machen.</p>
            </div>

            <div class="grid md:grid-cols-3 gap-8">
                <div class="p-6 bg-slate-50 rounded-xl border border-slate-100 hover:border-indigo-100 hover:shadow-lg transition-all">
                    <!-- ICON: activity -->
                    <div class="w-12 h-12 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center mb-4"><svg class="icon icon-lg" viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg></div>
                    <h3 class="text-xl font-bold text-slate-900 mb-2" data-i18n="features.f1.title">Smart Smoothing</h3>
                    <p class="text-slate-500 text-sm leading-relaxed" data-i18n="features.f1.desc">Unser "Moving Average" Algorithmus entfernt das Zittern der Hand und sorgt für glatte, schwungvolle Kurven.</p>
                </div>
                <div class="p-6 bg-slate-50 rounded-xl border border-slate-100 hover:border-indigo-100 hover:shadow-lg transition-all">
                    <!-- ICON: feather -->
                    <div class="w-12 h-12 bg-purple-100 text-purple-600 rounded-lg flex items-center justify-center mb-4"><svg class="icon icon-lg" viewBox="0 0 24 24"><path d="M12.67 19a2 2 0 0 0 1.416-.588l6.154-6.154a6 6 0 0 0-8.485-8.485L4.887 6.641a1 1 0 0 0-.294.708v10.173a3 3 0 0 0 3 3h6.154a3 3 0 0 0 2.122-.882l.844-.84zm-2.96-2.961.879.88a1 1 0 0 0 1.415 0l8.364-8.364a4 4 0 0 0-5.657-5.657l-6.363 6.363a1 1 0 0 0-.293.707v4.243a1 1 0 0 0 1 1h4.243a1 1 0 0 0 .707-.293l1.15-1.15zM7.839 16.243 4.5 19.5m1.414-8.85 2.829 2.829"/></svg></div>
                    <h3 class="text-xl font-bold text-slate-900 mb-2" data-i18n="features.f2.title">Drucksimulation</h3>
                    <p class="text-slate-500 text-sm leading-relaxed" data-i18n="features.f2.desc">Der Kalligrafie-Modus simuliert eine echte Füllfeder, indem er die Strichbreite basierend auf der Geschwindigkeit variiert.</p>
                </div>
                <div class="p-6 bg-slate-50 rounded-xl border border-slate-100 hover:border-indigo-100 hover:shadow-lg transition-all">
                    <!-- ICON: file-check (using layers as fallback or check-square) using file-check path -->
                    <div class="w-12 h-12 bg-green-100 text-green-600 rounded-lg flex items-center justify-center mb-4"><svg class="icon icon-lg" viewBox="0 0 24 24"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="m9 15 2 2 4-4"/></svg></div>
                    <h3 class="text-xl font-bold text-slate-900 mb-2" data-i18n="features.f3.title">Transparentes PNG</h3>
                    <p class="text-slate-500 text-sm leading-relaxed" data-i18n="features.f3.desc">Lade deine Unterschrift mit transparentem Hintergrund herunter. Perfekt für Word, Google Docs oder PDF-Editoren.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- FAQ -->
    <section id="faq" class="py-20 bg-slate-50 border-t border-slate-200">
        <div class="max-w-3xl mx-auto px-4 sm:px-6">
            <h2 class="text-3xl font-bold text-slate-900 mb-10 text-center" data-i18n="faq.title">Häufige Fragen</h2>
            <div class="space-y-4">
                <details class="group bg-white rounded-lg border border-slate-200 p-4 open:shadow-md transition-all cursor-pointer">
                    <summary class="flex justify-between items-center font-medium text-slate-800 list-none"><span data-i18n="faq.q1">Ist das sicher?</span><span class="transition group-open:rotate-180"><svg class="icon text-slate-400" viewBox="0 0 24 24"><path d="m6 9 6 6 6-6"/></svg></span></summary>
                    <div class="text-slate-500 mt-3 text-sm leading-relaxed" data-i18n="faq.a1">Ja, absolut. Der gesamte Prozess findet lokal in deinem Browser mittels JavaScript statt.</div>
                </details>
                <details class="group bg-white rounded-lg border border-slate-200 p-4 open:shadow-md transition-all cursor-pointer">
                    <summary class="flex justify-between items-center font-medium text-slate-800 list-none"><span data-i18n="faq.q2">Kann ich die Unterschrift in PDFs nutzen?</span><span class="transition group-open:rotate-180"><svg class="icon text-slate-400" viewBox="0 0 24 24"><path d="m6 9 6 6 6-6"/></svg></span></summary>
                    <div class="text-slate-500 mt-3 text-sm leading-relaxed" data-i18n="faq.a2">Ja. Die Datei wird als PNG mit transparentem Hintergrund gespeichert.</div>
                </details>
                <details class="group bg-white rounded-lg border border-slate-200 p-4 open:shadow-md transition-all cursor-pointer">
                    <summary class="flex justify-between items-center font-medium text-slate-800 list-none"><span data-i18n="faq.q3">Funktioniert es auf dem Handy?</span><span class="transition group-open:rotate-180"><svg class="icon text-slate-400" viewBox="0 0 24 24"><path d="m6 9 6 6 6-6"/></svg></span></summary>
                    <div class="text-slate-500 mt-3 text-sm leading-relaxed" data-i18n="faq.a3">Hervorragend sogar. Du kannst deinen Finger oder einen Stylus verwenden.</div>
                </details>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="bg-slate-900 text-slate-400 py-12">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 flex flex-col md:flex-row justify-between items-center gap-6">
            <div class="flex items-center gap-2">
                <!-- ICON: pen-line -->
                <svg class="icon text-indigo-500" viewBox="0 0 24 24"><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/></svg>
                <span class="font-semibold text-slate-200">SignaturGen</span>
            </div>
            <div class="text-sm">&copy; 2024 SignaturGen. <span data-i18n="footer.rights">Alle Rechte vorbehalten.</span></div>
            <div class="flex gap-4">
                <button onclick="openInfoModal('impressum-modal')" class="hover:text-white transition-colors" data-i18n="footer.imprint">Impressum</button>
                <button onclick="openInfoModal('privacy-modal')" class="hover:text-white transition-colors" data-i18n="footer.privacy">Datenschutz</button>
            </div>
        </div>
    </footer>

    <!-- MODALS -->
    
    <!-- FEATURES MODAL -->
    <div id="features-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center modal-overlay opacity-0 transition-opacity duration-300 px-4" onclick="handleModalClick(event, 'features-modal')">
        <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-lg w-full transform transition-all scale-95 border border-slate-200 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-slate-900" data-i18n="modal.features.title">Features im Überblick</h3>
                <button onclick="closeInfoModal('features-modal')" class="text-slate-400 hover:text-slate-600 hover:bg-slate-100 p-1 rounded-full transition-all"><svg class="icon-lg" viewBox="0 0 24 24"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>
            </div>
            <div class="space-y-4">
                <div class="flex gap-4 p-3 rounded-lg hover:bg-slate-50"><div class="bg-blue-100 p-2 rounded-lg text-blue-600 h-fit"><svg class="icon" viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg></div><div><h4 class="font-bold text-slate-800" data-i18n="features.f1.title">Smart Smoothing</h4><p class="text-sm text-slate-500 mt-1" data-i18n="features.f1.desc"></p></div></div>
                <div class="flex gap-4 p-3 rounded-lg hover:bg-slate-50"><div class="bg-purple-100 p-2 rounded-lg text-purple-600 h-fit"><svg class="icon" viewBox="0 0 24 24"><path d="M12.67 19a2 2 0 0 0 1.416-.588l6.154-6.154a6 6 0 0 0-8.485-8.485L4.887 6.641a1 1 0 0 0-.294.708v10.173a3 3 0 0 0 3 3h6.154a3 3 0 0 0 2.122-.882l.844-.84zm-2.96-2.961.879.88a1 1 0 0 0 1.415 0l8.364-8.364a4 4 0 0 0-5.657-5.657l-6.363 6.363a1 1 0 0 0-.293.707v4.243a1 1 0 0 0 1 1h4.243a1 1 0 0 0 .707-.293l1.15-1.15zM7.839 16.243 4.5 19.5m1.414-8.85 2.829 2.829"/></svg></div><div><h4 class="font-bold text-slate-800" data-i18n="features.f2.title">Drucksimulation</h4><p class="text-sm text-slate-500 mt-1" data-i18n="features.f2.desc"></p></div></div>
                <div class="flex gap-4 p-3 rounded-lg hover:bg-slate-50"><div class="bg-green-100 p-2 rounded-lg text-green-600 h-fit"><svg class="icon" viewBox="0 0 24 24"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="m9 15 2 2 4-4"/></svg></div><div><h4 class="font-bold text-slate-800" data-i18n="features.f3.title">Transparentes PNG</h4><p class="text-sm text-slate-500 mt-1" data-i18n="features.f3.desc"></p></div></div>
            </div>
        </div>
    </div>

    <!-- HOWTO MODAL -->
    <div id="howto-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center modal-overlay opacity-0 transition-opacity duration-300 px-4" onclick="handleModalClick(event, 'howto-modal')">
        <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-lg w-full transform transition-all scale-95 border border-slate-200 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-slate-900" data-i18n="nav.howto">So funktioniert's</h3>
                <button onclick="closeInfoModal('howto-modal')" class="text-slate-400 hover:text-slate-600 hover:bg-slate-100 p-1 rounded-full transition-all"><svg class="icon-lg" viewBox="0 0 24 24"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>
            </div>
            <div class="relative pl-8 space-y-8 before:content-[''] before:absolute before:left-[11px] before:top-2 before:bottom-2 before:w-[2px] before:bg-slate-100">
                <div class="relative"><div class="absolute -left-8 bg-indigo-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ring-4 ring-white">1</div><h4 class="font-bold text-slate-800" data-i18n="howto.step1.title">Unterschreiben</h4><p class="text-sm text-slate-500 mt-1" data-i18n="howto.step1.desc">Nutze deine Maus...</p></div>
                <div class="relative"><div class="absolute -left-8 bg-indigo-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ring-4 ring-white">2</div><h4 class="font-bold text-slate-800" data-i18n="howto.step2.title">Anpassen</h4><p class="text-sm text-slate-500 mt-1" data-i18n="howto.step2.desc">Wähle Farbe...</p></div>
                <div class="relative"><div class="absolute -left-8 bg-indigo-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ring-4 ring-white">3</div><h4 class="font-bold text-slate-800" data-i18n="howto.step3.title">Herunterladen</h4><p class="text-sm text-slate-500 mt-1" data-i18n="howto.step3.desc">Klicke auf Speichern...</p></div>
            </div>
            <div class="mt-6 pt-4 border-t border-slate-100 flex justify-end">
                <button onclick="closeInfoModal('howto-modal'); scrollToTool();" class="text-indigo-600 font-medium text-sm hover:underline" data-i18n="howto.try_now">Jetzt ausprobieren &rarr;</button>
            </div>
        </div>
    </div>

    <!-- FAQ MODAL -->
    <div id="faq-header-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center modal-overlay opacity-0 transition-opacity duration-300 px-4" onclick="handleModalClick(event, 'faq-header-modal')">
        <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-lg w-full transform transition-all scale-95 border border-slate-200 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-slate-900" data-i18n="faq.title">Häufige Fragen</h3>
                <button onclick="closeInfoModal('faq-header-modal')" class="text-slate-400 hover:text-slate-600 hover:bg-slate-100 p-1 rounded-full transition-all"><svg class="icon-lg" viewBox="0 0 24 24"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>
            </div>
            <div class="space-y-4">
                <details class="group bg-slate-50 rounded-lg p-3 open:bg-white open:shadow-sm open:ring-1 open:ring-slate-200 transition-all cursor-pointer"><summary class="flex justify-between items-center font-medium text-slate-800 list-none text-sm"><span data-i18n="faq.q1">Sicher?</span><span class="transition group-open:rotate-180"><svg class="icon text-slate-400" viewBox="0 0 24 24"><path d="m6 9 6 6 6-6"/></svg></span></summary><div class="text-slate-500 mt-2 text-xs leading-relaxed" data-i18n="faq.a1">...</div></details>
                <details class="group bg-slate-50 rounded-lg p-3 open:bg-white open:shadow-sm open:ring-1 open:ring-slate-200 transition-all cursor-pointer"><summary class="flex justify-between items-center font-medium text-slate-800 list-none text-sm"><span data-i18n="faq.q2">PDF?</span><span class="transition group-open:rotate-180"><svg class="icon text-slate-400" viewBox="0 0 24 24"><path d="m6 9 6 6 6-6"/></svg></span></summary><div class="text-slate-500 mt-2 text-xs leading-relaxed" data-i18n="faq.a2">...</div></details>
                <details class="group bg-slate-50 rounded-lg p-3 open:bg-white open:shadow-sm open:ring-1 open:ring-slate-200 transition-all cursor-pointer"><summary class="flex justify-between items-center font-medium text-slate-800 list-none text-sm"><span data-i18n="faq.q3">Kostenlos?</span><span class="transition group-open:rotate-180"><svg class="icon text-slate-400" viewBox="0 0 24 24"><path d="m6 9 6 6 6-6"/></svg></span></summary><div class="text-slate-500 mt-2 text-xs leading-relaxed" data-i18n="faq.a3">...</div></details>
            </div>
        </div>
    </div>

    <!-- IMPRESSUM/PRIVACY -->
    <div id="impressum-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center modal-overlay opacity-0 transition-opacity duration-300 px-4" onclick="handleModalClick(event, 'impressum-modal')">
        <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-lg w-full transform transition-all scale-95 border border-slate-200 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-slate-900" data-i18n="footer.imprint">Impressum</h3>
                <button onclick="closeInfoModal('impressum-modal')" class="text-slate-400 hover:text-slate-600 hover:bg-slate-100 p-1 rounded-full transition-all"><svg class="icon-lg" viewBox="0 0 24 24"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>
            </div>
            <div class="prose prose-sm text-slate-600">
                <p>Max Mustermann<br>Musterstraße 1<br>12345 City</p>
                <p>Contact: info@example.com</p>
            </div>
        </div>
    </div>
    
    <div id="privacy-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center modal-overlay opacity-0 transition-opacity duration-300 px-4" onclick="handleModalClick(event, 'privacy-modal')">
        <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-lg w-full transform transition-all scale-95 border border-slate-200 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-slate-900" data-i18n="footer.privacy">Datenschutz</h3>
                <button onclick="closeInfoModal('privacy-modal')" class="text-slate-400 hover:text-slate-600 hover:bg-slate-100 p-1 rounded-full transition-all"><svg class="icon-lg" viewBox="0 0 24 24"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>
            </div>
            <div class="prose prose-sm text-slate-600">
                <p data-i18n="tool.privacy_hint">Datenschutz: Deine Unterschrift verlässt niemals deinen Browser.</p>
            </div>
        </div>
    </div>

    <!-- TOAST -->
    <div id="toast" class="hidden fixed bottom-5 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl text-sm flex items-center gap-3 transition-all duration-300 z-50 border border-slate-700">
        <div id="toast-icon-wrapper" class="flex items-center justify-center"></div>
        <span id="toast-message" class="font-medium"></span>
    </div>

    <!-- DOWNLOAD MODAL -->
    <div id="download-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center modal-overlay opacity-0 transition-opacity duration-300 px-4">
        <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full transform transition-all scale-95 border border-slate-200" id="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-slate-900" data-i18n="modal.download.title">Deine Unterschrift</h3>
                <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600 hover:bg-slate-100 p-1 rounded-full transition-all"><svg class="icon-lg" viewBox="0 0 24 24"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>
            </div>
            <div class="checkerboard rounded-xl p-6 mb-6 flex justify-center items-center border border-slate-200 bg-white shadow-inner min-h-[160px]">
                <img id="signature-preview" class="max-w-full h-auto max-h-48 object-contain drop-shadow-sm" />
            </div>
            <div class="bg-blue-50 p-4 rounded-xl border border-blue-100 mb-6 flex gap-3 items-start">
                <!-- ICON: info -->
                <svg class="icon text-blue-600 flex-shrink-0 mt-0.5" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                <div class="text-sm text-blue-800">
                    <span class="font-bold" data-i18n="modal.download.tip_title">Download gestartet?</span><br>
                    <span data-i18n="modal.download.tip_text">Falls nicht: Rechtsklick auf das Bild und "Bild speichern".</span>
                </div>
            </div>
            <div class="flex justify-end gap-3">
                <button onclick="closeModal()" class="w-full bg-slate-900 text-white px-5 py-3 rounded-xl hover:bg-slate-800 transition-colors font-medium" data-i18n="modal.download.close">Fertig</button>
            </div>
        </div>
    </div>

    <script>
        // PERFORMANCE: SVG Strings statt lucide library loading
        const ICONS = {
            'check-circle': '<svg class="icon text-green-400" viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>',
            'alert-circle': '<svg class="icon text-red-400" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>'
        };

        const translations = {
            de: {
                "meta.title": "SignaturGen - Kostenlose Digitale Unterschrift",
                "nav.features": "Features",
                "nav.howto": "So funktioniert's",
                "nav.faq": "FAQ",
                "hero.badge": "Neu: KI-gestützte Glättung",
                "hero.title_line1": "Deine Unterschrift.",
                "hero.title_line2": "Digital & Perfekt.",
                "hero.subtitle": "Erstelle blitzschnell eine transparente PNG-Unterschrift für deine PDF-Dokumente. 100% lokal.",
                "tool.placeholder": "Hier unterschreiben",
                "tool.select_style": "Stil auswählen",
                "tool.close": "Schließen",
                "tool.optimize": "Optimieren",
                "tool.save": "Speichern",
                "tool.privacy_hint": "Datenschutz: Deine Unterschrift verlässt niemals deinen Browser.",
                "features.title": "Warum SignaturGen?",
                "features.subtitle": "Fortschrittliche Algorithmen für elegante Vektor-Unterschriften.",
                "features.f1.title": "Smart Smoothing",
                "features.f1.desc": "Entfernt das Zittern der Hand für glatte Kurven.",
                "features.f2.title": "Drucksimulation",
                "features.f2.desc": "Simuliert Füllfederhalter-Effekte basierend auf Geschwindigkeit.",
                "features.f3.title": "Transparentes PNG",
                "features.f3.desc": "Perfekt für Word, Google Docs oder PDF-Editoren.",
                "faq.title": "Häufige Fragen",
                "faq.q1": "Ist das sicher?",
                "faq.a1": "Ja. Alles passiert lokal im Browser. Keine Server-Speicherung.",
                "faq.q2": "Kann ich es in PDFs nutzen?",
                "faq.a2": "Ja, das PNG ist transparent und ideal für Dokumente.",
                "faq.q3": "Ist es kostenlos?",
                "faq.a3": "Ja, 100% kostenlos und werbefrei.",
                "footer.rights": "Alle Rechte vorbehalten.",
                "footer.imprint": "Impressum",
                "footer.privacy": "Datenschutz",
                "modal.features.title": "Features im Überblick",
                "modal.download.title": "Deine Unterschrift",
                "modal.download.tip_title": "Download gestartet?",
                "modal.download.tip_text": "Falls nicht: Rechtsklick auf das Bild und 'Bild speichern'.",
                "modal.download.close": "Fertig",
                "howto.step1.title": "Unterschreiben",
                "howto.step1.desc": "Nutze Maus, Touchpad oder Finger im weißen Feld.",
                "howto.step2.title": "Anpassen",
                "howto.step2.desc": "Wähle Farbe, Dicke und klicke 'Optimieren'.",
                "howto.step3.title": "Herunterladen",
                "howto.step3.desc": "Klicke 'Speichern' für ein transparentes PNG.",
                "howto.try_now": "Jetzt ausprobieren →",
                "toast.cleared": "Leinwand gereinigt",
                "toast.empty": "Bitte zuerst unterschreiben!",
                "toast.style_applied": "Stil angewendet:",
                "style.original": "Original",
                "style.smooth": "Glatt",
                "style.modern": "Modern",
                "style.elegant": "Elegant",
                "style.calligraphy": "Kalligrafie"
            },
            en: {
                "meta.title": "SignaturGen - Free Digital Signature",
                "nav.features": "Features",
                "nav.howto": "How it works",
                "nav.faq": "FAQ",
                "hero.badge": "New: AI Smoothing",
                "hero.title_line1": "Your Signature.",
                "hero.title_line2": "Digital & Perfect.",
                "hero.subtitle": "Create a transparent PNG signature for your PDFs instantly. 100% local.",
                "tool.placeholder": "Sign here",
                "tool.select_style": "Select Style",
                "tool.close": "Close",
                "tool.optimize": "Optimize",
                "tool.save": "Save",
                "tool.privacy_hint": "Privacy: Your signature never leaves your browser.",
                "features.title": "Why SignaturGen?",
                "features.subtitle": "Advanced algorithms for elegant vector-like signatures.",
                "features.f1.title": "Smart Smoothing",
                "features.f1.desc": "Removes shaky hands for smooth curves.",
                "features.f2.title": "Pressure Simulation",
                "features.f2.desc": "Simulates fountain pen effects based on speed.",
                "features.f3.title": "Transparent PNG",
                "features.f3.desc": "Perfect for Word, Google Docs or PDF editors.",
                "faq.title": "Common Questions",
                "faq.q1": "Is it secure?",
                "faq.a1": "Yes. Everything happens locally in your browser. No server storage.",
                "faq.q2": "Can I use it in PDFs?",
                "faq.a2": "Yes, the PNG is transparent and ideal for documents.",
                "faq.q3": "Is it free?",
                "faq.a3": "Yes, 100% free and ad-free.",
                "footer.rights": "All rights reserved.",
                "footer.imprint": "Imprint",
                "footer.privacy": "Privacy",
                "modal.features.title": "Features Overview",
                "modal.download.title": "Your Signature",
                "modal.download.tip_title": "Download started?",
                "modal.download.tip_text": "If not: Right-click image and choose 'Save Image'.",
                "modal.download.close": "Done",
                "howto.step1.title": "Sign",
                "howto.step1.desc": "Use mouse, touchpad or finger in the white box.",
                "howto.step2.title": "Customize",
                "howto.step2.desc": "Choose color, thickness and click 'Optimize'.",
                "howto.step3.title": "Download",
                "howto.step3.desc": "Click 'Save' to get a transparent PNG.",
                "howto.try_now": "Try now →",
                "toast.cleared": "Canvas cleared",
                "toast.empty": "Please sign first!",
                "toast.style_applied": "Style applied:",
                "style.original": "Original",
                "style.smooth": "Smooth",
                "style.modern": "Modern",
                "style.elegant": "Elegant",
                "style.calligraphy": "Calligraphy"
            },
            es: {
                "meta.title": "SignaturGen - Firma Digital Gratuita",
                "nav.features": "Funciones",
                "nav.howto": "Cómo funciona",
                "nav.faq": "FAQ",
                "hero.badge": "Nuevo: Suavizado IA",
                "hero.title_line1": "Tu Firma.",
                "hero.title_line2": "Digital y Perfecta.",
                "hero.subtitle": "Crea una firma PNG transparente para tus PDF al instante. 100% local.",
                "tool.placeholder": "Firma aquí",
                "tool.select_style": "Elegir Estilo",
                "tool.close": "Cerrar",
                "tool.optimize": "Optimizar",
                "tool.save": "Guardar",
                "tool.privacy_hint": "Privacidad: Tu firma nunca sale de tu navegador.",
                "features.title": "¿Por qué SignaturGen?",
                "features.subtitle": "Algoritmos avanzados para firmas elegantes.",
                "features.f1.title": "Suavizado Inteligente",
                "features.f1.desc": "Elimina temblores para curvas suaves.",
                "features.f2.title": "Simulación de Presión",
                "features.f2.desc": "Simula efectos de pluma estilográfica.",
                "features.f3.title": "PNG Transparente",
                "features.f3.desc": "Perfecto para Word, Google Docs o editores PDF.",
                "faq.title": "Preguntas Frecuentes",
                "faq.q1": "¿Es seguro?",
                "faq.a1": "Sí. Todo ocurre localmente en tu navegador.",
                "faq.q2": "¿Puedo usarlo en PDFs?",
                "faq.a2": "Sí, el PNG es transparente.",
                "faq.q3": "¿Es gratis?",
                "faq.a3": "Sí, 100% gratis y sin anuncios.",
                "footer.rights": "Todos los derechos reservados.",
                "footer.imprint": "Aviso Legal",
                "footer.privacy": "Privacidad",
                "modal.features.title": "Resumen de Funciones",
                "modal.download.title": "Tu Firma",
                "modal.download.tip_title": "¿Descarga iniciada?",
                "modal.download.tip_text": "Si no: Clic derecho y 'Guardar imagen'.",
                "modal.download.close": "Listo",
                "howto.step1.title": "Firmar",
                "howto.step1.desc": "Usa ratón o dedo en el recuadro blanco.",
                "howto.step2.title": "Personalizar",
                "howto.step2.desc": "Elige color y haz clic en 'Optimizar'.",
                "howto.step3.title": "Descargar",
                "howto.step3.desc": "Clic en 'Guardar' para obtener el PNG.",
                "howto.try_now": "Probar ahora →",
                "toast.cleared": "Lienzo borrado",
                "toast.empty": "¡Firma primero!",
                "toast.style_applied": "Estilo aplicado:",
                "style.original": "Original",
                "style.smooth": "Suave",
                "style.modern": "Moderno",
                "style.elegant": "Elegante",
                "style.calligraphy": "Caligrafía"
            },
            fr: {
                "meta.title": "SignaturGen - Signature Numérique Gratuite",
                "nav.features": "Fonctionnalités",
                "nav.howto": "Comment ça marche",
                "nav.faq": "FAQ",
                "hero.badge": "Nouveau : Lissage IA",
                "hero.title_line1": "Votre Signature.",
                "hero.title_line2": "Numérique & Parfaite.",
                "hero.subtitle": "Créez une signature PNG transparente pour vos PDF. 100% local.",
                "tool.placeholder": "Signez ici",
                "tool.select_style": "Choisir le style",
                "tool.close": "Fermer",
                "tool.optimize": "Optimiser",
                "tool.save": "Sauvegarder",
                "tool.privacy_hint": "Confidentialité : Votre signature ne quitte jamais votre navigateur.",
                "features.title": "Pourquoi SignaturGen ?",
                "features.subtitle": "Algorithmes avancés pour des signatures vectorielles.",
                "features.f1.title": "Lissage Intelligent",
                "features.f1.desc": "Supprime les tremblements pour des courbes lisses.",
                "features.f2.title": "Simulation de Pression",
                "features.f2.desc": "Simule une plume selon la vitesse.",
                "features.f3.title": "PNG Transparent",
                "features.f3.desc": "Parfait pour Word, Google Docs ou PDF.",
                "faq.title": "Questions Fréquentes",
                "faq.q1": "Est-ce sécurisé ?",
                "faq.a1": "Oui. Tout se passe localement dans le navigateur.",
                "faq.q2": "Utilisable dans les PDF ?",
                "faq.a2": "Oui, le fichier est un PNG transparent.",
                "faq.q3": "Est-ce gratuit ?",
                "faq.a3": "Oui, 100% gratuit.",
                "footer.rights": "Tous droits réservés.",
                "footer.imprint": "Mentions Légales",
                "footer.privacy": "Confidentialité",
                "modal.features.title": "Aperçu des fonctionnalités",
                "modal.download.title": "Votre Signature",
                "modal.download.tip_title": "Téléchargement lancé ?",
                "modal.download.tip_text": "Sinon : Clic droit et 'Enregistrer l'image'.",
                "modal.download.close": "Terminé",
                "howto.step1.title": "Signer",
                "howto.step1.desc": "Utilisez souris ou doigt dans la zone blanche.",
                "howto.step2.title": "Personnaliser",
                "howto.step2.desc": "Choisissez couleur et cliquez 'Optimiser'.",
                "howto.step3.title": "Télécharger",
                "howto.step3.desc": "Cliquez 'Sauvegarder' pour le PNG.",
                "howto.try_now": "Essayer maintenant →",
                "toast.cleared": "Zone effacée",
                "toast.empty": "Veuillez signer d'abord !",
                "toast.style_applied": "Style appliqué :",
                "style.original": "Original",
                "style.smooth": "Lisse",
                "style.modern": "Moderne",
                "style.elegant": "Élégant",
                "style.calligraphy": "Calligraphie"
            },
            pt: {
                "meta.title": "SignaturGen - Assinatura Digital Gratuita",
                "nav.features": "Recursos",
                "nav.howto": "Como funciona",
                "nav.faq": "FAQ",
                "hero.badge": "Novo: Suavização IA",
                "hero.title_line1": "Sua Assinatura.",
                "hero.title_line2": "Digital e Perfeita.",
                "hero.subtitle": "Crie uma assinatura PNG transparente para seus PDFs. 100% local.",
                "tool.placeholder": "Assine aqui",
                "tool.select_style": "Escolher Estilo",
                "tool.close": "Fechar",
                "tool.optimize": "Otimizar",
                "tool.save": "Salvar",
                "tool.privacy_hint": "Privacidade: Sua assinatura nunca sai do navegador.",
                "features.title": "Por que SignaturGen?",
                "features.subtitle": "Algoritmos avançados para assinaturas elegantes.",
                "features.f1.title": "Suavização Inteligente",
                "features.f1.desc": "Remove tremores para curvas suaves.",
                "features.f2.title": "Simulação de Pressão",
                "features.f2.desc": "Simula efeitos de caneta tinteiro.",
                "features.f3.title": "PNG Transparente",
                "features.f3.desc": "Perfeito para Word, Google Docs ou PDFs.",
                "faq.title": "Perguntas Frequentes",
                "faq.q1": "É seguro?",
                "faq.a1": "Sim. Tudo acontece localmente no seu navegador.",
                "faq.q2": "Posso usar em PDFs?",
                "faq.a2": "Sim, o PNG é transparente.",
                "faq.q3": "É gratuito?",
                "faq.a3": "Sim, 100% gratuito e sem anúncios.",
                "footer.rights": "Todos os direitos reservados.",
                "footer.imprint": "Ficha Técnica",
                "footer.privacy": "Privacidade",
                "modal.features.title": "Visão Geral",
                "modal.download.title": "Sua Assinatura",
                "modal.download.tip_title": "Download iniciado?",
                "modal.download.tip_text": "Se não: Clique direito e 'Salvar imagem'.",
                "modal.download.close": "Pronto",
                "howto.step1.title": "Assinar",
                "howto.step1.desc": "Use mouse ou dedo na área branca.",
                "howto.step2.title": "Personalizar",
                "howto.step2.desc": "Escolha cor e clique em 'Otimizar'.",
                "howto.step3.title": "Baixar",
                "howto.step3.desc": "Clique em 'Salvar' para obter o PNG.",
                "howto.try_now": "Tentar agora →",
                "toast.cleared": "Tela limpa",
                "toast.empty": "Assine primeiro!",
                "toast.style_applied": "Estilo aplicado:",
                "style.original": "Original",
                "style.smooth": "Suave",
                "style.modern": "Moderno",
                "style.elegant": "Elegante",
                "style.calligraphy": "Caligrafia"
            }
        };

        let currentLang = 'en';

        // PERFORMANCE: Debounce function to limit excessive resize events
        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }

        function detectLanguage() {
            const browserLang = navigator.language.slice(0, 2);
            const supportedLangs = ['de', 'en', 'es', 'fr', 'pt'];
            currentLang = supportedLangs.includes(browserLang) ? browserLang : 'en';
            applyLanguage(currentLang);
        }

        function applyLanguage(lang) {
            document.documentElement.lang = lang;
            const texts = translations[lang];
            
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (texts[key]) el.innerText = texts[key];
            });

            if(!document.getElementById('variations-wrapper').classList.contains('hidden')){
                generatePreviews();
            }
        }
        
        function t(key) {
            return translations[currentLang][key] || key;
        }

        const canvas = document.getElementById('signature-pad');
        const container = document.getElementById('canvas-container');
        const ctx = canvas.getContext('2d');
        const placeholder = document.getElementById('placeholder-text');
        
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let penColor = '#000000';
        let penWidth = 2;

        let originalStrokes = []; 
        let displayStrokes = [];
        let currentStroke = [];
        let currentStyle = 'original';

        function scrollToTool() {
            document.getElementById('tool-section').scrollIntoView({behavior: 'smooth'});
        }

        function resizeCanvas() {
            const ratio = Math.max(window.devicePixelRatio || 1, 1);
            
            canvas.width = container.clientWidth * ratio;
            canvas.height = container.clientHeight * ratio;
            ctx.scale(ratio, ratio);
            
            if (displayStrokes.length > 0) {
                if (currentStyle === 'calligraphy') {
                    redrawCalligraphy(displayStrokes, ctx);
                } else {
                    redrawStrokes(displayStrokes, ctx);
                }
            } else {
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.strokeStyle = penColor;
                ctx.lineWidth = penWidth;
            }
        }

        // PERFORMANCE: Debounce resize event
        window.addEventListener('resize', debounce(resizeCanvas, 150));
        setTimeout(resizeCanvas, 100);

        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            let clientX, clientY;
            
            if (e.touches && e.touches.length > 0) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }

        function startDrawing(e) {
            isDrawing = true;
            document.getElementById('variations-wrapper').classList.add('hidden');
            
            const pos = getPos(e);
            lastX = pos.x;
            lastY = pos.y;
            placeholder.style.opacity = '0';
            currentStroke = [{ x: pos.x, y: pos.y }];
            
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.strokeStyle = penColor;
            ctx.lineWidth = penWidth;

            ctx.beginPath();
            ctx.arc(pos.x, pos.y, penWidth / 2, 0, Math.PI * 2);
            ctx.fillStyle = penColor;
            ctx.fill();
            
            currentStyle = 'original';
        }

        function draw(e) {
            if (!isDrawing) return;
            if(e.type.includes('touch')) {
                if(e.cancelable) e.preventDefault(); 
            }
            
            const pos = getPos(e);
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            
            currentStroke.push({ x: pos.x, y: pos.y });
            lastX = pos.x;
            lastY = pos.y;
        }

        function stopDrawing() {
            if (!isDrawing) return;
            isDrawing = false;
            if (currentStroke.length > 0) {
                const strokeData = {
                    points: JSON.parse(JSON.stringify(currentStroke)), 
                    color: penColor,
                    width: penWidth
                };
                originalStrokes.push(strokeData);
                displayStrokes = JSON.parse(JSON.stringify(originalStrokes));
            }
        }

        function cloneStrokes(strokes) {
            return JSON.parse(JSON.stringify(strokes));
        }

        function applyMovingAverage(strokes, iterations) {
            const newStrokes = cloneStrokes(strokes);
            newStrokes.forEach(stroke => {
                let points = stroke.points;
                if (points.length <= 2) return;
                for (let k = 0; k < iterations; k++) {
                    const smoothed = [points[0]];
                    for (let i = 1; i < points.length - 1; i++) {
                        smoothed.push({
                            x: (points[i-1].x + points[i].x + points[i+1].x) / 3,
                            y: (points[i-1].y + points[i].y + points[i+1].y) / 3
                        });
                    }
                    smoothed.push(points[points.length - 1]);
                    points = smoothed;
                }
                stroke.points = points;
            });
            return newStrokes;
        }

        function applyChaikin(strokes, iterations) {
            const newStrokes = cloneStrokes(strokes);
            newStrokes.forEach(stroke => {
                let points = stroke.points;
                if (points.length <= 2) return;
                for (let k = 0; k < iterations; k++) {
                    const nextPoints = [points[0]];
                    for (let i = 0; i < points.length - 1; i++) {
                        const p0 = points[i];
                        const p1 = points[i+1];
                        nextPoints.push({ x: 0.75 * p0.x + 0.25 * p1.x, y: 0.75 * p0.y + 0.25 * p1.y });
                        nextPoints.push({ x: 0.25 * p0.x + 0.75 * p1.x, y: 0.25 * p0.y + 0.75 * p1.y });
                    }
                    nextPoints.push(points[points.length - 1]);
                    points = nextPoints;
                }
                stroke.points = points;
            });
            return newStrokes;
        }

        function getSqSegDist(p, p1, p2) {
            let x = p1.x, y = p1.y, dx = p2.x - x, dy = p2.y - y;
            if (dx !== 0 || dy !== 0) {
                const t = ((p.x - x) * dx + (p.y - y) * dy) / (dx * dx + dy * dy);
                if (t > 1) { x = p2.x; y = p2.y; }
                else if (t > 0) { x += dx * t; y += dy * t; }
            }
            const ddx = p.x - x, ddy = p.y - y;
            return ddx * ddx + ddy * ddy;
        }
        function simplifyDPStep(points, first, last, sqTolerance, simplified) {
            let maxSqDist = sqTolerance;
            let index = -1;
            for (let i = first + 1; i < last; i++) {
                const sqDist = getSqSegDist(points[i], points[first], points[last]);
                if (sqDist > maxSqDist) { index = i; maxSqDist = sqDist; }
            }
            if (index > -1) {
                if (index - first > 1) simplifyDPStep(points, first, index, sqTolerance, simplified);
                simplified.push(points[index]);
                if (last - index > 1) simplifyDPStep(points, index, last, sqTolerance, simplified);
            }
        }
        function applyDouglasPeucker(strokes, tolerance) {
            const newStrokes = cloneStrokes(strokes);
            const sqTolerance = tolerance * tolerance;
            newStrokes.forEach(stroke => {
                const points = stroke.points;
                if (points.length <= 2) return;
                const simplified = [points[0]];
                simplifyDPStep(points, 0, points.length - 1, sqTolerance, simplified);
                simplified.push(points[points.length - 1]);
                stroke.points = simplified;
            });
            return newStrokes;
        }

        function generatePreviews() {
            if (originalStrokes.length === 0) {
                showToast(t('toast.empty'), true);
                return;
            }

            const wrapper = document.getElementById('variations-wrapper');
            const container = document.getElementById('variations-container');
            wrapper.classList.remove('hidden');
            wrapper.classList.add('animate-fade-in');
            container.innerHTML = ''; 

            const variations = [
                { name: t('style.original'), type: 'original' },
                { name: t('style.smooth'), type: 'smooth' },     
                { name: t('style.modern'), type: 'modern' },    
                { name: t('style.elegant'), type: 'elegant' },  
                { name: t('style.calligraphy'), type: 'calligraphy' } 
            ];

            variations.forEach(v => {
                let processedStrokes;
                let renderMode = 'normal';

                if (v.type === 'original') processedStrokes = cloneStrokes(originalStrokes);
                else if (v.type === 'smooth') processedStrokes = applyMovingAverage(originalStrokes, 3);
                else if (v.type === 'modern') processedStrokes = applyDouglasPeucker(originalStrokes, 2.5); 
                else if (v.type === 'elegant') {
                    let temp = applyDouglasPeucker(originalStrokes, 1);
                    processedStrokes = applyChaikin(temp, 2); 
                }
                else if (v.type === 'calligraphy') {
                    processedStrokes = applyMovingAverage(originalStrokes, 2);
                    renderMode = 'calligraphy';
                }

                const card = document.createElement('div');
                card.className = `preview-card flex-shrink-0 w-28 flex flex-col items-center bg-white rounded-lg border-2 border-slate-100 cursor-pointer p-2 hover:border-indigo-300`;
                if(v.type === currentStyle) card.classList.add('selected');

                const miniCanvas = document.createElement('canvas');
                miniCanvas.width = 120;
                miniCanvas.height = 70;
                miniCanvas.className = "w-full h-16 bg-white rounded mb-2 object-contain pointer-events-none";
                
                const miniCtx = miniCanvas.getContext('2d');
                drawThumbnail(miniCtx, processedStrokes, miniCanvas.width, miniCanvas.height, renderMode);

                const label = document.createElement('span');
                label.className = "text-xs font-semibold text-slate-600";
                label.innerText = v.name;

                card.appendChild(miniCanvas);
                card.appendChild(label);

                card.onclick = () => {
                    document.querySelectorAll('.preview-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    
                    displayStrokes = processedStrokes;
                    currentStyle = v.type;
                    
                    ctx.clearRect(0, 0, canvas.width / (window.devicePixelRatio || 1), canvas.height / (window.devicePixelRatio || 1));
                    
                    if (renderMode === 'calligraphy') {
                        redrawCalligraphy(displayStrokes, ctx);
                    } else {
                        redrawStrokes(displayStrokes, ctx);
                    }
                    showToast(`${t('toast.style_applied')} "${v.name}"`);
                };

                container.appendChild(card);
            });
        }

        function closeVariations() {
            document.getElementById('variations-wrapper').classList.add('hidden');
        }

        function redrawStrokes(strokes, context) {
            strokes.forEach(stroke => {
                const points = stroke.points;
                if (points.length < 2) return;

                context.beginPath();
                context.strokeStyle = stroke.color;
                context.lineWidth = stroke.width;
                context.lineCap = 'round';
                context.lineJoin = 'round';

                context.moveTo(points[0].x, points[0].y);
                if (points.length === 2) {
                     context.lineTo(points[1].x, points[1].y);
                } else {
                    let i;
                    for (i = 1; i < points.length - 2; i++) {
                        const c = (points[i].x + points[i + 1].x) / 2;
                        const d = (points[i].y + points[i + 1].y) / 2;
                        context.quadraticCurveTo(points[i].x, points[i].y, c, d);
                    }
                    context.quadraticCurveTo(points[i].x, points[i].y, points[i + 1].x, points[i + 1].y);
                }
                context.stroke();
            });
        }

        function redrawCalligraphy(strokes, context) {
            strokes.forEach(stroke => {
                const points = stroke.points;
                if (points.length < 2) return;
                const baseWidth = stroke.width;
                const color = stroke.color;
                
                for (let i = 0; i < points.length - 1; i++) {
                    const p1 = points[i];
                    const p2 = points[i+1];
                    const dist = Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));
                    let dynamicWidth = Math.max(1, baseWidth * (1 - Math.min(dist / 30, 0.6)));
                    
                    context.beginPath();
                    context.lineWidth = dynamicWidth;
                    context.lineCap = 'round';
                    context.strokeStyle = color;
                    context.moveTo(p1.x, p1.y);
                    context.lineTo(p2.x, p2.y);
                    context.stroke();
                    
                    context.beginPath();
                    context.arc(p2.x, p2.y, dynamicWidth/2, 0, Math.PI*2);
                    context.fillStyle = color;
                    context.fill();
                }
            });
        }

        function drawThumbnail(context, strokes, width, height, renderMode) {
            let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
            let hasPoints = false;
            strokes.forEach(s => s.points.forEach(p => {
                minX = Math.min(minX, p.x);
                minY = Math.min(minY, p.y);
                maxX = Math.max(maxX, p.x);
                maxY = Math.max(maxY, p.y);
                hasPoints = true;
            }));
            if (!hasPoints) return;

            const padding = 8;
            const contentW = maxX - minX;
            const contentH = maxY - minY;
            const scaleX = (width - padding * 2) / Math.max(contentW, 1);
            const scaleY = (height - padding * 2) / Math.max(contentH, 1);
            const scale = Math.min(scaleX, scaleY);
            const offsetX = (width - contentW * scale) / 2 - minX * scale;
            const offsetY = (height - contentH * scale) / 2 - minY * scale;

            context.save();
            context.translate(offsetX, offsetY);
            context.scale(scale, scale);

            if (renderMode === 'calligraphy') {
                redrawCalligraphy(strokes, context);
            } else {
                redrawStrokes(strokes, context);
            }
            context.restore();
        }

        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        canvas.addEventListener('touchstart', startDrawing, { passive: false });
        canvas.addEventListener('touchmove', draw, { passive: false });
        canvas.addEventListener('touchend', stopDrawing);

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width / (window.devicePixelRatio || 1), canvas.height / (window.devicePixelRatio || 1));
            originalStrokes = []; 
            displayStrokes = [];
            currentStroke = [];
            document.getElementById('variations-wrapper').classList.add('hidden');
            placeholder.style.opacity = '1';
            showToast(t('toast.cleared'));
            currentStyle = 'original';
        }

        function setColor(color, btnElement) {
            penColor = color;
            ctx.strokeStyle = color;
            if (btnElement) {
                document.querySelectorAll('.color-btn').forEach(btn => {
                    btn.classList.remove('scale-110');
                    btn.style.borderColor = '#cbd5e1';
                });
                btnElement.classList.add('scale-110');
                btnElement.style.borderColor = color;
            }
        }

        function setLineWidth(width) {
            penWidth = parseInt(width);
            ctx.lineWidth = penWidth;
        }

        function downloadSignature() {
            if (originalStrokes.length === 0 && placeholder.style.opacity !== '0') {
                showToast(t('toast.empty'), true);
                return;
            }

            const dataUrl = canvas.toDataURL('image/png');
            const modal = document.getElementById('download-modal');
            const preview = document.getElementById('signature-preview');
            const modalContent = document.getElementById('modal-content');
            
            preview.src = dataUrl;
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modalContent.classList.remove('scale-95');
                modalContent.classList.add('scale-100');
            }, 10);

            try {
                const link = document.createElement('a');
                link.download = 'signature.png';
                link.href = dataUrl;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (e) {
                console.log("Auto-Download blockiert");
            }
        }

        function closeModal() {
            const modal = document.getElementById('download-modal');
            const modalContent = document.getElementById('modal-content');
            modal.classList.add('opacity-0');
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            setTimeout(() => { modal.classList.add('hidden'); }, 300);
        }

        function openInfoModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            const content = modal.querySelector('div[class*="bg-white"]');
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                if(content) {
                    content.classList.remove('scale-95');
                    content.classList.add('scale-100');
                }
            }, 10);
        }

        function closeInfoModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            const content = modal.querySelector('div[class*="bg-white"]');
            modal.classList.add('opacity-0');
            if(content) {
                content.classList.remove('scale-100');
                content.classList.add('scale-95');
            }
            setTimeout(() => { modal.classList.add('hidden'); }, 300);
        }

        function handleModalClick(event, modalId) {
            if (event.target.id === modalId) {
                closeInfoModal(modalId);
            }
        }

        document.getElementById('download-modal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            const msgEl = toast.querySelector('span');
            const iconWrapper = document.getElementById('toast-icon-wrapper');
            msgEl.textContent = message;
            
            // PERFORMANCE: Direct SVG insertion
            iconWrapper.innerHTML = isError ? ICONS['alert-circle'] : ICONS['check-circle'];
            
            toast.classList.remove('hidden');
            toast.classList.remove('opacity-0');
            toast.classList.remove('translate-y-4');
            setTimeout(() => {
                toast.classList.add('opacity-0');
                toast.classList.add('translate-y-4');
                setTimeout(() => toast.classList.add('hidden'), 300);
            }, 3000);
        }
        
        // Init
        setColor('#000000', document.querySelector('.color-btn')); 
        detectLanguage();
    </script>
</body>
</html>